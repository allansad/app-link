<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>반장창고 앱링크 생성기</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 60px 16px;
    }

    .container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      padding: 40px 32px;
      width: 100%;
      max-width: 560px;
    }

    h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 14px;
      color: #888;
      margin-bottom: 32px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #555;
      margin-bottom: 6px;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      border-color: #4a90d9;
    }

    input[type="text"]::placeholder {
      color: #bbb;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, opacity 0.2s;
    }

    .btn:active {
      opacity: 0.8;
    }

    .btn-primary {
      background: #4a90d9;
      color: #fff;
      width: 100%;
      margin-top: 16px;
    }

    .btn-primary:hover {
      background: #3a7bc8;
    }

    .result-section {
      margin-top: 28px;
      display: none;
    }

    .result-section.show {
      display: block;
    }

    .result-box {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 14px;
      margin-top: 6px;
      word-break: break-all;
      font-size: 13px;
      font-family: 'SF Mono', 'Fira Code', monospace;
      color: #333;
      line-height: 1.6;
    }

    .copy-btn {
      background: #28a745;
      color: #fff;
      width: 100%;
      margin-top: 12px;
    }

    .copy-btn:hover {
      background: #218838;
    }

    .copy-btn.copied {
      background: #6c757d;
    }

    .error {
      color: #dc3545;
      font-size: 13px;
      margin-top: 8px;
      display: none;
    }

    .error.show {
      display: block;
    }

    .divider {
      border: none;
      border-top: 1px solid #eee;
      margin: 24px 0;
    }

    .info {
      margin-top: 28px;
      padding: 16px;
      background: #f0f4ff;
      border-radius: 8px;
      font-size: 12px;
      color: #555;
      line-height: 1.8;
    }

    .info strong {
      display: block;
      margin-bottom: 4px;
      font-size: 13px;
      color: #333;
    }

    .info code {
      background: #e2e8f0;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 11px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>반장창고 앱링크 생성기</h1>
    <p class="subtitle">웹 URL을 입력하면 앱링크용 URL을 생성합니다.</p>

    <label for="urlInput">URL 입력</label>
    <input
      type="text"
      id="urlInput"
      placeholder="https://bjchango.com/product/detail?id=123"
      autocomplete="off"
      spellcheck="false"
    />
    <p class="error" id="error"></p>

    <button class="btn btn-primary" id="generateBtn">앱링크 생성</button>

    <div class="result-section" id="resultSection">
      <hr class="divider" />

      <label>생성된 앱링크 URL</label>
      <div class="result-box" id="resultBox"></div>
      <button class="btn copy-btn" id="copyBtn">복사하기</button>
    </div>

    <div class="info">
      <strong>인코딩되는 특수문자</strong>
      <code>?</code> → <code>%3F</code>&nbsp;&nbsp;
      <code>&</code> → <code>%26</code>&nbsp;&nbsp;
      <code>=</code> → <code>%3D</code>&nbsp;&nbsp;
      <code>#</code> → <code>%23</code>&nbsp;&nbsp;
      <code>%</code> → <code>%25</code>&nbsp;&nbsp;
      <code>+</code> → <code>%2B</code>&nbsp;&nbsp;
      <code>공백</code> → <code>%20</code>
    </div>
  </div>

  <script>
    const urlInput = document.getElementById('urlInput');
    const generateBtn = document.getElementById('generateBtn');
    const resultSection = document.getElementById('resultSection');
    const resultBox = document.getElementById('resultBox');
    const copyBtn = document.getElementById('copyBtn');
    const errorEl = document.getElementById('error');

    function showError(msg) {
      errorEl.textContent = msg;
      errorEl.classList.add('show');
      resultSection.classList.remove('show');
    }

    function hideError() {
      errorEl.classList.remove('show');
    }

    function generateAppLink() {
      hideError();

      const raw = urlInput.value.trim();
      if (!raw) {
        showError('URL을 입력해주세요.');
        return;
      }

      let parsed;
      try {
        parsed = new URL(raw);
      } catch {
        showError('올바른 URL 형식이 아닙니다. (예: https://bjchango.com/...)');
        return;
      }

      // pathname + search + hash
      const redirectPath = parsed.pathname + parsed.search + parsed.hash;

      if (redirectPath === '/') {
        showError('경로가 없는 URL입니다. 리다이렉트할 경로를 포함해주세요.');
        return;
      }

      const encoded = encodeURIComponent(redirectPath);
      const appLinkUrl = `${parsed.origin}/link?redirect=${encoded}`;

      resultBox.textContent = appLinkUrl;
      resultSection.classList.add('show');
      copyBtn.textContent = '복사하기';
      copyBtn.classList.remove('copied');
    }

    async function copyToClipboard() {
      const text = resultBox.textContent;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = '복사 완료!';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.textContent = '복사하기';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch {
        // fallback
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        copyBtn.textContent = '복사 완료!';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.textContent = '복사하기';
          copyBtn.classList.remove('copied');
        }, 2000);
      }
    }

    generateBtn.addEventListener('click', generateAppLink);
    copyBtn.addEventListener('click', copyToClipboard);

    urlInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') generateAppLink();
    });
  </script>
</body>
</html>
